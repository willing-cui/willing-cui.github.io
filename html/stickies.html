<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="page_title">Functional Tabs - Restored Frosted Glass</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="../assets/js/jquery.min.js"></script>
    <script src="../assets/js/dynamic_stickies_bg.js"></script>
    <script src="../assets/js/util.js"></script>
    <link rel="stylesheet" href="../assets/css/main.css" />
    <link rel="stylesheet" rel="prefetch" href="../assets/css/custom.css" />
    <link rel="stylesheet" rel="prefetch" href="../assets/css/stickies.css" />
</head>

<body class="is-preload">
    <!-- BG -->
    <div id="bg" style="z-index: -100;"></div>
    
    <!-- Close Button -->
    <a href="../index.html">
        <div class="stickies_icon" style="background-image: url('../images/close-w.png');" 
             title="Close" data-i18n-title="close_title"></div>
    </a>
    
    <div class="main-stack-wrapper">
        <div class="note-stack-container">
            <div class="frosted-note" data-note="1">
                <div class="note-tab" data-note-id="1" data-i18n="trending_tab">Trending Topics</div>
                <h3 data-i18n="trending_title">Trending Data (Latest)</h3>
                <div class="note-body" id="trending-data-container">
                    <p data-i18n="loading_trending">Loading data...</p>
                </div>
            </div>

            <div class="frosted-note active" data-note="2">
                <div class="note-tab active-tab" data-note-id="2" data-i18n="gold_price_tab">Gold Price</div>
                <h3 data-i18n="gold_price_title">Gold Price Trend</h3>
                <div class="note-body">
                    <div id="chart-area">
                    </div>

                    <div id="chart-controls">
                        <button data-window="7" class="active" data-i18n="days_7">7 Days</button>
                        <button data-window="30" data-i18n="days_30">30 Days</button>
                        <button data-window="365" data-i18n="days_365">Year</button>
                    </div>

                    <h4 style="margin-top: 1rem; color: #333;" data-i18n="aggregated_data">Aggregated Data (Date / Price per gram):</h4>
                    <div id="chart-debug-data" data-i18n="loading_price">Loading price data...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="../assets/js/stickies.js"></script>
    
    <script>
        $(function () {
            // 根据当前语言加载内容
            const lang = getCurrentLanguage();
            
            // 设置初始语言
            setLanguage(lang);
        })

        // 语言资源文件
        const translations = {
            en: {
                "page_title": "Willing's Stickies",
                "trending_tab": "Trending Topics",
                "trending_title": "Trending Topics",
                "gold_price_tab": "Gold Price",
                "gold_price_title": "Gold Price Trend",
                "days_7": "7 Days",
                "days_30": "30 Days",
                "days_365": "Year",
                "aggregated_data": "Aggregated Data (Date / Price per gram):",
                "loading_trending": "Loading data...",
                "loading_price": "Loading price data...",
                "close_title": "Close"
            },
            zh: {
                "page_title": "Willing 的便利贴",
                "trending_tab": "热搜话题",
                "trending_title": "热搜话题",
                "gold_price_tab": "金价走势",
                "gold_price_title": "金价趋势图",
                "days_7": "7 天",
                "days_30": "30 天",
                "days_365": "1 年",
                "aggregated_data": "汇总数据（日期 / 每克价格）：",
                "loading_trending": "加载数据中...",
                "loading_price": "加载价格数据中...",
                "close_title": "关闭"
            }
        };

        // 获取当前语言
        function getCurrentLanguage() {
            const savedLang = localStorage.getItem('preferred-language');
            const browserLang = navigator.language.startsWith('zh') ? 'zh' : 'en';
            return savedLang || browserLang || 'en';
        }

        // 设置语言
        function setLanguage(lang) {
            // 更新页面标题
            document.title = translations[lang].page_title;
            
            // 更新所有带 data-i18n 属性的元素
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                        element.placeholder = translations[lang][key];
                    } else {
                        element.innerHTML = translations[lang][key];
                    }
                }
            });
            
            // 更新所有带 data-i18n-title 属性的元素
            document.querySelectorAll('[data-i18n-title]').forEach(element => {
                const key = element.getAttribute('data-i18n-title');
                if (translations[lang][key]) {
                    element.setAttribute('title', translations[lang][key]);
                }
            });
            
            // 更新页面语言属性
            document.documentElement.lang = lang;
            
            // 将函数暴露到全局作用域，以便stickies.js可以调用
            window.getCurrentLanguage = getCurrentLanguage;
            window.setLanguage = setLanguage;
        }
    </script>
</body>

</html>